<template>    <div class="seckill-detail">        <el-card class="!border-none" shadow="never">            <el-page-header :content="pageTitle" @back="handleRouteBack" />        </el-card>        <el-form            ref="formRef"            :model="formData"            label-width="120px"            :rules="rules"            :disabled="readOnly"        >            <template v-for="(compItem, compIndex) in comLists" :key="compIndex">                    <component :is="compItem.comp" :modelValue="formData"></component>            </template>        </el-form>        <footer-btns>            <el-button type="primary" @click="handleSave" :disabled="readOnly">保存</el-button>        </footer-btns>    </div></template><script lang="ts" setup name="SeckillDetail">import type { FormInstance, FormRules } from 'element-plus'import { seckillDetail, seckillEdit, seckillAdd } from '@/api/marketing/seckill'import type { SeckillFormParamsType } from '@/api/marketing/seckill.d'import useMultipleTabs from '@/hooks/useMultipleTabs'import Setting from './component/setting.vue'import Goods from './component/goods.vue'import Rule from './component/rule.vue'import feedback from '@/utils/feedback'const route = useRoute()const router = useRouter()const readOnly: any = route.query.read_onlyconst comLists = [    {        comp: markRaw(Setting)    },    {        comp: markRaw(Goods)    },    {        comp: markRaw(Rule)    }]const formData = reactive<SeckillFormParamsType>({    id: '',    name: '',    remarks: '',    startTime: '',    endTime: '',    limitStatus: 0,    maxBuy: '',    goods: []})const { removeTab } = useMultipleTabs()const formRef = shallowRef<FormInstance>()const rules = reactive<FormRules>({    name: [{ required: true, message: '请输入活动名称', trigger: 'blur' }],    startTime: [{ required: true, message: '请选择活动时间', trigger: 'blur' }],    goods: [{        required: true,        validator: (rule: object, value: string, callback: any) => {            if (!formData.goods.length) {                callback(new Error('请选择秒杀商品'))            }            callback()        },        trigger: ['blur', 'change']    }],    limitStatus: [        { required: true, message: '请选择每单限制', trigger: 'blur' },        {            validator: (rule: object, value: string, callback: any) => {                if (formData.limitStatus == 1 && (formData.maxBuy == '' || formData.maxBuy < 0)) {                    if (formData.maxBuy == '') return callback(new Error('请输入每单限制件数'))                    if (formData.maxBuy < 0) return callback(new Error('每单限制件数不能为负数'))                }                callback()            },            trigger: 'blur'        }    ]})const pageTitle = computed(() => {    if (readOnly && route.query.id) {        return '秒杀详情'    } else if (route.query.id) {        return '编辑秒杀活动'    } else {        return '新增秒杀活动'    }})const getDetails = async () => {    const data = await seckillDetail({        id: route.query.id as any    })    Object.keys(formData).forEach((key) => {        //@ts-ignore        formData[key] = data[key]    })}const handleSave = async () => {    try {        await formRef.value?.validate()        if (route.query.id) {            await seckillEdit(formData)        } else {            await seckillAdd(formData)        }        handleRouteBack()    } catch (error) {        console.log('保存秒杀报错', error)    }}const handleRouteBack = () => {    removeTab()    router.back()}onMounted(() => {    route.query.id && getDetails()})</script>