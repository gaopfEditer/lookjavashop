<template>    <div class="coupon-lists">        <el-card class="!border-none" shadow="never">            <el-alert                type="warning"                title="温馨提示：1.查看优惠券领取记录；2.未使用的优惠券可以作废。"                :closable="false"                show-icon            />            <el-form ref="formRef" class="mb-[-16px] mt-[16px]" :model="queryParams" :inline="true">                <el-form-item label="用户信息">                    <el-input                        class="w-[280px]"                        v-model="queryParams.keyword"                        placeholder="请输入用户编号/昵称"                        :clearable="true"                        @keyup.enter="resetPage"                    />                </el-form-item>                <el-form-item label="优惠券名称">                    <el-input                        class="w-[280px]"                        v-model="queryParams.couponName"                        placeholder="请输入优惠券名称"                        :clearable="true"                        @keyup.enter="resetPage"                    />                </el-form-item>                <el-form-item label="领取方式">                    <el-select class="w-[280px]" v-model="queryParams.channel">                        <el-option label="全部" value />                        <el-option label="用户领取" :value="1" />                        <el-option label="系统发放" :value="2" />                    </el-select>                </el-form-item>                <el-form-item label="发放人">                    <el-select class="w-[280px]" v-model="queryParams.issuer">                        <el-option label="全部" value />                        <el-option label="系统" :value="0" />                        <el-option                            v-for="item in adminList"                            :key="item.id"                            :label="item.username"                            :value="item.id"                        />                    </el-select>                </el-form-item>                <el-form-item label="领取时间">                    <daterange-picker                        value-format="x"                        :second="true"                        v-model:startTime="queryParams.startTime"                        v-model:endTime="queryParams.endTime"                    />                </el-form-item>                <el-form-item>                    <el-button type="primary" @click="resetPage">查询</el-button>                    <el-button @click="resetParams">重置</el-button>                </el-form-item>            </el-form>        </el-card>        <el-card class="!border-none mt-4" :body-style="{ 'padding-top': '10px' }" shadow="never">            <!-- 选项卡 -->            <el-tabs v-model="queryParams.type" @tab-change="changeTabs">                <template v-for="(tabItem, tabIndex) in tabsParams.TabsEnumMap" :key="tabIndex">                    <el-tab-pane                        :label="`${tabItem.label}(${pager.extend[tabItem.type] || 0})`"                        :name="tabItem.name"                    />                </template>            </el-tabs>            <el-button                type="default"                :plain="true"                :disabled="!multipleSelection.length"                @click="handleRepeal(multipleSelection.map(item => item.id), multipleSelection.map(item => item.couponName).toString())"            >                批量作废            </el-button>            <!-- 表格 -->            <el-table                size="large"                class="mt-4"                v-loading="pager.loading"                :data="pager.lists"                @selection-change="handleSelectionChange"            >                <el-table-column type="selection" width="55" />                <el-table-column label="用户信息" min-width="180">                    <template #default="{ row }">                        <div class="flex items-center">                            <el-image                                fit="cover"                                :src="row.avatar"                                class="flex-none w-[58px] h-[58px]"                            />                            <div class="ml-4 overflow-hidden">                                <el-tooltip effect="dark" :content="row.nickname" placement="top">                                    <div class="text-base truncate">                                        {{ row.nickname }}                                    </div>                                </el-tooltip>                            </div>                        </div>                    </template>                </el-table-column>                <el-table-column label="优惠券名称" prop="couponName" min-width="140" />                <el-table-column label="领取方式" min-width="120">                    <template #default="{ row }">                        <div v-if="row.channelMsg == '用户领取'">                            {{ row.channelMsg }}                        </div>                        <div                            v-else                            class="text-success"                        >                            {{ row.channelMsg }}                        </div>                    </template>                </el-table-column>                <el-table-column label="发放人" prop="issuerMsg" min-width="100" />                <el-table-column label="领取时间" prop="createTime" min-width="180" />                <el-table-column label="过期时间" prop="invalidTime" min-width="180" />                <el-table-column label="使用状态" min-width="120">                    <template #default="{ row }">                        <el-tag v-if="row?.status == 0" type="danger">未使用</el-tag>                        <el-tag v-if="row?.status == 1" type="success">已使用</el-tag>                        <el-tag v-if="row?.status == 2" type="info" >已过期</el-tag>                        <el-tag v-if="row?.status == 3" type="info" >已作废</el-tag>                    </template>                </el-table-column>                <el-table-column label="使用时间" prop="useTime" min-width="200" />                <el-table-column label="操作" width="120" fixed="right">                    <template #default="{ row }">                        <el-button                            v-if="row?.status == 1"                            v-perms="['order:order:detail']"                            type="primary"                            :link="true"                        >                            <router-link                                :to="{                                    path: getRoutePath('order:order:detail'),                                    query: {                                        id: row.orderId                                    }                                }"                            >                                查看订单                            </router-link>                        </el-button>                        <el-button                            v-perms="['marketing:coupon:repeal']"                            v-if="row?.status == 0"                            type="primary"                            :link="true"                            @click="handleRepeal([row.id], row.couponName)"                        >                            作废                        </el-button>                    </template>                </el-table-column>            </el-table>            <div class="flex justify-end mt-4">                <pagination v-model="pager" @change="getLists" />            </div>        </el-card>    </div></template><script lang="ts" setup name="CouponRecordLists">import { usePaging } from '@/hooks/usePaging'import { adminLists } from '@/api/perms/admin'import { couponRecordLists, couponRepeal } from '@/api/marketing/coupon'import type { CouponRecordListQueryParamsType } from "@/api/marketing/coupon.d"import feedback from '@/utils/feedback'import {ElTable} from "element-plus";import {getRoutePath} from "@/router";// Tab类型enum TabsEnum {    ALL = 'all',    NOT = 'not',    USE = 'use',    EXPIRE = 'expire',    REPEAL = 'repeal'}const tabsParams = reactive({    TabsEnumMap: [        {            label: '全部',            name: '',            type: TabsEnum.ALL        },        {            label: '未使用',            name: '0',            type: TabsEnum.NOT        },        {            label: '已使用',            name: '1',            type: TabsEnum.USE        },        {            label: '已过期',            name: '2',            type: TabsEnum.EXPIRE        },        {            label: '已作废',            name: '3',            type: TabsEnum.REPEAL        }    ]})const adminList = ref<any[]>([])const multipleSelection = ref<any[]>([])const queryParams = reactive<CouponRecordListQueryParamsType>({    keyword: '',    couponName: '',    channel: '',    issuer: '',    startTime: '',    endTime: '',    type: ''})const { pager, getLists, resetPage, resetParams } = usePaging({    fetchFun: couponRecordLists,    params: queryParams})const changeTabs = (name: string) => {    queryParams.type = name    getLists()}const getAdminLists = async () => {    try {        const { lists } = await adminLists({ pageSize: 60, pageNo: 1 })        adminList.value = lists    } catch (error) {        console.log('获取管理员列表失败', error)    }}const handleSelectionChange = (value: any[]) => {    multipleSelection.value = value}const handleRepeal = async (ids: number[], name: string) => {    try {        await feedback.confirm(`确定要将(${name})的优惠券作废吗？`)        await couponRepeal({ ids })        getLists()    } catch (error) {        console.log('删除优惠券失败=>', error)    }}onMounted(() => {    getLists()    getAdminLists()})</script>